### sed(dotinstallの勉強メモ)

### sed(セド)コマンドの使い方

+ Macに gnu-sed(グヌーセド)をインストール(Macのsedは制限があるので使わない)
+ `brew install gnu-sed`
+ `.bashrc` に、 `alias sed=gsed`と記載することでコマンド省略化


### 基本コマンド

    -e    //指定したスクリプト（条件式）で変換処理を行う　複数のコマンドを打つときに使用する

    '3d'  // 3行目を削除の意味

    '3d'  //アドレス+コマンドのペアで処理 3 = 3行目、d = 削除

    sed -e '3d' hoge.txt //hoge.txtの３行目を削除する
    sed '3d' hoge.txt  //条件式が一つの時は、 -eは必要ない

    sed -i '3d' hoge.txt //実際のファイルを上書きする場合は、 -iオプションを付ける

    sed -i.bak '3d' hoge.txt //実際のファイルを上書きして、さらにbackupファイルを作成する

    sed -f read.sed hoge.txt //hoge.txtに対して、read.sedファイルの内容を実行する

    '3p'  //3行目 プリント

    sed -n '3p' hoge.txt  //3行目だけを　出力する  -n

    '3q' //３行目　処理を終了する

    sed '3q' hoge.txt //hoge.txt の3行目で処理を終了する

    '3i' //3行目　の前に文字列を挿入する。追加する文字列は、 \（バックスラッシュ）の後ろに記載する

    sed -e '3i\--- start ---' hoge.txt

    '$a' //最後の行　の後に文字列を挿入する。 \（バックスラッシュ）の後ろに記載する

    sed -e '$a\--- end ---' hoge.txt

    = // 行番号を出力することができる

    sed -n '/hoge/=' hoge.txt //hoge.txt 内で、 hogeの文字と一致する文字列がある行番号を出力する



### パターンスペース

    1. fileから一行読み込んでパターンスペースに格納
    2. addressにマッチ? →　パターンスペースに対して、commandを実行
    3. 出力など

### アドレス

    '3d' //3行目　削除
    '3!d' //3行目以外　削除
    '1d;3d' //1行目と3行目　削除
    '1,3d' //1行目から3行目　削除
    '1~2d' //1行目から2飛ばしで　削除
    '$d' // 一番最後の行　削除
    '3,$d' //3から最後の行　削除
    '/i$/' //正規表現 iが最後にくる場合 削除
    'd' //全ての行　削除


### 文字置換

    yコマンド　//一文字だけ置換する　　yの後ろに /変換する文字/変換後の文字/ を入れる　（破壊的変更）

    sed 'y/t/T/' hoge.txt  //hoge.txt　内の　小文字のtを大文字のTに変える

    sed 'y/to/TO/' hoge.txt //hoge.txt 内の 小文字のtを大文字のT, 小文字の大文字のOに変える（順番に対応している）


### 文字列の置換

    sコマンド　//文字列を置換する　（非破壊的変更）
    's/変換する文字列/変換後の文字列/'
    gフラグ // 全部に対して　文字列置換
    nフラグ // n(数字)　番目の対象が置換
    iフラグ // 大文字小文字区別しない置換

    sed 's/apple/Apple/' regxp.txt // appleを最初の一つだけ Appleに置換
    sed 's/apple/Apple/g' regxp.txt // appleをすべて Appleに置換
    sed 's/apple/Apple/4' regxp.txt // 4番目のappleを　Appleに置換
    sed 's/apple/Ringo/ig' regxp.txt // 大文字小文字区別せず　すべてのappleを　Ringoに置換

    sed 's/[aA]pple/Ringo/g' regxp.txt //大文字小文字区別せず、正規表現でRingoに置換

### 便利な置換方法(うまく動かないので調査)

    & //マッチした文字列を使用して置換する
    sed 's/[0-5]/【&】/' regxp.txt

    () //括弧で囲まれたマッチした文字列は、 \1, \2　という形でつかることができる
    sed 's/\([0-5]\) \(.*\)/\2 +\1+ /' regxp.txt


### ホールドスペースの利用

    行をまたいで複雑な処理をする場合に活用

　　　h:  パターンスペース　→　ホールドスペース
    g:  ホールドスペース　→　パターンスペース
    x:  パターンスペース　⇔　ホールドスペース
　　　
    やり方
    1. 変換用のファイルを作成する
    2. 変換用のファイルに、ホールドスペースなどの処理を記載する
    3. -f で、変換用のファイルを読み込み実行

    変換しているやり方
    1. マッチすると、記載されているh: g: x: を実行
    2. パターンスペースやホールドスペースの中身がコピーされたり、交換されたりする

    ※難しい・・・・




